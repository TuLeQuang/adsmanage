<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Demo 3D by Admicro</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />	
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<!-- meta for video panorama --> 
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<meta http-equiv="x-ua-compatible" content="IE=edge" />
	<!-- END meta for video panorama --> 
	
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
	<script type="text/javascript" src="js/thavis360.free.min.js" charset="UTF-8"></script>
	<!-- load thư viện cho 3D -->
	<script type='text/javascript' src="http://www.mrdoob.com/lab/javascript/threejs/css3d/three-css3d.min.js"></script>
	<script src="viewer/embedpano.js"></script>
	<link href="js/thavis360.css" rel="stylesheet" type="text/css" />



	<script type="text/javascript">
		function wdHeight(){var a;"number"==typeof window.innerWidth?a=window.innerHeight:document.documentElement&&document.documentElement.clientHeight?a=document.documentElement.clientHeight:document.body&&document.body.clientHeight&&(a=document.body.clientHeight);return a};
		function wdWidth(){var a;"number"==typeof window.innerWidth?a=window.innerWidth:document.documentElement&&document.documentElement.clientWidth?a=document.documentElement.clientWidth:document.body&&document.body.clientWidth&&
		(a=document.body.clientWidth);return a}	
		
	</script>
</head>

<body width = wdWidth() height = wdHeight() >
<div id = "div_container" style=" width:100%; height:100%; zIndex: 90">
	<div style="display:block" id="js360-widget"></div>
	<div id="pano" style=" width:100%; 
		height:100%; 
		position: absolute;
		z-index: 1; 
		margin-left: -8px;
		display: none;
		margin-top: -390px"
		>
	</div>
</div>
	
	<!-- style cho frame2 -->
	<style type='text/css'>



    body {
	overflow: hidden;
	position: relative;
	background: white;
	color: white;
	padding: 0;
	margin: 10px;
	width: 100%;
	height: 100%;
	}

	#panaromic_wr {
		position: absolute;
		z-index: 8888;
		padding: 0;
		margin: 10px;
		width: 100%;
		height: 100%;
	}

	#InCarBtn {
		color: #900;
		margin-top: 10px;
		position: absolute;
		z-index: 9999;
	}

	#VideoPanoramaBtn {
		color: #900;
		margin-top: 10px;
		margin-left: 100px;
		position: absolute;
		z-index: 9999;
	}

	#BackBtn {
		color: #900;
		margin-top: 10px;
		margin-left: 100px;
		position: absolute;
		z-index: 9999;
		display: none;
	}
	
  	</style>
  	<!-- style cho frame2 -->
  	<script type="text/javascript">
  		window.onload = (function(){
  			var js360_widget = document.getElementById("js360-widget");

  			console.log("js360_widget = " + js360_widget);
			js360_widget.style.width = wdWidth();
			js360_widget.style.height = wdHeight();
			
  		})();
  	</script>
  	<!-- script main frame2 -->
	<script type='text/javascript'>//<![CDATA[
	var animate;
	var scene,renderer;
	var camera;
	 
	//document.getElementById("frame2").style.display = "none";
		jQuery( document ).ready(function() {
			jQuery("#js360-widget").thavis360({
				serverLocation:'',
				objDir:'spin',
				imgTotal:52,
				imgStart:1,
				features:false,
				stepping:10,
				spinInterval:70,
				lang:'en',
				targetSpinInterval:25,
				spinDirection:'forward',
				navPosition:'bottom',
				//zoomMode:'follow',
				descPosition:'left',
				hsWidth:32,
				hsHeight:32,
				hsFadeInDuration:800,

			});
		});

		var frame2Flag = false;
		function openframe2() {
			console.log("clicked openframe2");

			document.getElementById("js360-widget").style.display = "none";
			document.getElementById("VideoPanoramaBtn").style.display = "none";
			document.getElementById("InCarBtn").style.display = "none";
			document.getElementById("panaromic_wr").style.display = 'block';
			document.getElementById("js360-widget").style.zIndex = '10000';
			document.getElementById("BackBtn").style.display = "block";

			console.log("frame2Flag = "+ frame2Flag);
			if (!frame2Flag) {
				var animate = function(){
				    requestAnimationFrame(animate);
				    renderer.render(scene, camera);
				}

				document.getElementById("js360-widget").style.display = "none";
				document.getElementById("VideoPanoramaBtn").style.visibility = "hidden";
				document.getElementById("InCarBtn").style.display = "none";

				//adding threejs sence 
				var deg2rad = Math.PI / 180;
				var controls;

				camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
				camera.eulerOrder = "ZXY";

				scene = new THREE.Scene();
				var folder = "images/";
				var sides = [
				    [folder + "0001.jpg", 0, 0, 100, 0, 0, 0],
				    [folder + "0002.jpg", 100, 0, 0, 0, 1.57, 0],
				    [folder + "0003.jpg", 0, 0, -100, 0, 3.14, 0],
				    [folder + "0004.jpg", -100, 0, 0, 0, 4.71, 0 ],
				    [folder + "0005.jpg", 0, 100, 0, 4.71, 0, 0 ],
				    [folder + "0006.jpg", 0, -100, 0, 1.57, 0, 0 ]
				];

				var cube = new THREE.CSS3DObject( document.createElement('div') );
				for (var i = 0; i < sides.length; i ++) {
				    var element = document.createElement('img');
				    element.src = sides[i][0];
				    element.style.width = '805px';
				    element.style.height = '805px';
				    
				    var object = new THREE.CSS3DObject(element);
				    object.position.set(
				        sides[i][1],
				        sides[i][2],
				        sides[i][3]
				    );
				    object.rotation.set(
				        sides[i][4],
				        sides[i][5],
				        sides[i][6]
				    );
				    object.scale.set(
				        0.25,
				        0.25,
				        1
				    );
				    cube.add(object);
				}
				cube.rotation.x = -90;
				scene.add(cube);

				if (typeof window.DeviceOrientationEvent != "undefined") {
			    window.addEventListener("deviceorientation", function(e) {
			        camera.rotation.set (
			            !e.beta  ? 0 : e.beta * deg2rad,
			            !e.gamma ? 0 : e.gamma * deg2rad,
			            !e.alpha ? 0 : e.alpha * deg2rad
			        );
			    }, false);
			    
			    renderer = new THREE.CSS3DRenderer();
			    renderer.setSize(window.innerWidth, window.innerHeight);
			    renderer.domElement.style.position = 'absolute';
			    renderer.domElement.style.top = 0;

			    document.getElementById("panaromic_wr").appendChild(renderer.domElement);
				} else {
			    	alert("Device Orientation not supported");
				}
				animate();
				frame2Flag = true;
			}
		}

		function wdHeight(){var a;"number"==typeof window.innerWidth?a=window.innerHeight:document.documentElement&&document.documentElement.clientHeight?a=document.documentElement.clientHeight:document.body&&document.body.clientHeight&&(a=document.body.clientHeight);return a};
		function wdWidth(){var a;"number"==typeof window.innerWidth?a=window.innerWidth:document.documentElement&&document.documentElement.clientWidth?a=document.documentElement.clientWidth:document.body&&document.body.clientWidth&&
		(a=document.body.clientWidth);return a}	

		var videoPanoFlag = false;
		function VideoPanorama() {
			console.log("clicked VideoPanorama");
			console.log("videoPanoFlag = " + videoPanoFlag);
	  		if (!videoPanoFlag) {
		  		embedpano({swf:"viewer/krpano.swf", xml:"video/video.xml", target:"pano", html5:(document.domain ? "prefer" : "auto"), passQueryParameters:true});
		  		videoPanoFlag = true;
		  	}
		  	document.getElementById("pano").style.display = 'block';
		  	document.getElementById("InCarBtn").style.display = 'none';
		  	document.getElementById("VideoPanoramaBtn").style.display = 'none';
		  	document.getElementById("BackBtn").style.display = "block";
		  		
	 	}
	 	function onClickBack() {
	 		console.log("onClickBack");
	 		document.getElementById("pano").style.display = 'none';
	 		document.getElementById("js360-widget").style.display = 'block';
	 		document.getElementById("div_container").style.display = 'block';
	 		document.getElementById("BackBtn").style.display = 'none';
	 		document.getElementById("InCarBtn").style.display = 'block';
	 		document.getElementById("VideoPanoramaBtn").style.display = 'block';
	 		document.getElementById("VideoPanoramaBtn").style.visibility = 'visible';
	 		document.getElementById("panaromic_wr").style.display = 'none';
	 		console.log("detail VideoPanoramaBtn = " + VideoPanoramaBtn);
	 	}
	</script>

	<div id = "panaromic_wr"></div>
	<!-- Create button to panorama video -->
	<button id = "VideoPanoramaBtn" type="button" onmousedown = "VideoPanorama();">Video Panorama</button> 
	<button id = "InCarBtn" type="button" onmousedown = "openframe2()">In Car</button>
	<button id = "BackBtn" type="button" onmousedown= "onClickBack()" style="position: fixed; left: 5px; top: 5px zIndex: 9999 display: none">Back</button>
</body>